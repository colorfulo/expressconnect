# 多VPC专线接入 {#concept_p1l_rk5_ydb .concept}

您可以复用已接入到阿里云接入点的物理专线，连接多个VPC。

**说明：** 目前支持一根专线最多接入5个VPC，可提交工单增加配额。

## 使用场景 {#section_d52_1l5_ydb .section}

某公司在阿里云上开通了账号A，并创建了专有网络VPC-A。账号A已经申请开通了一条物理专线将该公司的本地数据中心和VPC-A连接了起来。该公司的一个子公司在阿里云上开通了一个账号B，账号B下有一个专有网络VPC-B。现在子公司希望将VPC-B与本地IDC连接起来。

由于账号A已经购买了专线并将本地IDC接入到阿里云的接入点上，所以子公司账号B的专有网络VPC-B可以复用账号A的专线。
如果账号A对应的VBR已经采用了非0的vlan id，该公司只需要创建一个新的VBR，并采用不一样的vlan id ，以及在新的VBR上重新创建一个路由器接口，再为VPC-B创建一个路由器接口，将两个新建的路由器接口连接起来即可。

如果账号A对应的VBR已经采用了id为0的vlan id，则需要删除现有的VBR，并重新创建vlan id 为非0（vlan id a）的VBR。以及基于新的vlan id （区别与vlan id a）创建一个新的VBR，以及在新的VBR上重新创建一个路由器接口，再为VPC-B创建一个路由器接口，将两个新建的路由器接口连接起来即可。

如下图所示（图片要换）。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13863/4227_zh-CN.png)

本教程以VBR预先设置了非0的vlan id为例介绍如何复用物理专线连接多个VPC。本教程中的VPC配置和专线配置如下：

|账号A|账号B|
|:--|:--|
|账号ID：12345678|账号ID：87654321|
|专有网络-   名称：VPC-A
-   地域：华北2（北京）
-   VPC ID：vpc-12345678
-   CIDR block：10.10.0.0/16

|专有网络-   名称：VPC-B
-   地域：华东1（杭州）
-   VPC ID：vpc-87654321
-   CIDR block：192.168.0.0/16

|
|专线连接-   VBR名称：专有网络-北京
-   VBR ID：vbr-12345678
-   专线ID：pc-AAA
-   VLAN ID：1000

|无|

## 步骤一：创建边界路由器 {#section_lpm_wl5_ydb .section}
完成以下操作在A账号下为B账号创建一个新的VBR：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**边界路由器** 。
3.  单击**新建边界路由器**，根据以下信息配置边界路由器，然后单击**确认创建**。
    -   **创建对象：为其他账户创建（并填入UID）**
    -   **物理专线：选择现有对应物理专线**
    -   **VLANID：1001**
4.  单击**确认创建**，完成创建。

## 步骤二：创建路由器接口 {#section_lpm_wl5_ydb .section}

在账号A新创建的VBR上以及账号B的VPC上各创建一个路由器接口，VPC的路由器和VBR可以通过路由器接口向对方发送消息。更多详情参考路由器接口。

**说明：** 边界路由器的路由器接口必须是连接发起端。

创建发起端路由器接口

完成以下操作为边界路由器创建路由器接口：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，选择**路由器接口**。单击**创建路由器接口**。
3.  配置路由器接口，本教程中的路由器接口配置如下：
    -   **连接场景：专线接入**
    -   **创建路由器接口场景：只创建发起端**
    -   **路由器类型：边界路由器**
    -   **地域：选择华北2（北京）**
    -   **接入点：北京-大兴A**
    -   **本端VBR ID：vbr-12345678**
    -   **对端地域：选择华东1（杭州）**
    -   **对端路由器类型：VPC路由器**
    -   **规格：大型1档（1Gb\)**
4.  单击**立即购买**，完成创建。

    大约一分钟后，返回路由器接口列表页面，选择对应的地域，即可看到账号A的路由器接口。本教程中账号A的路由器接口ID为ri-AAA。


创建接受端路由器接口

完成以下操作创建接受端路由器接口：

1.  使用帐号B登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，选择**路由器接口**。单击**创建路由器接口**。
3.  配置路由器接口，本教程中的路由器接口配置如下：
    -   **计费方式：按量计费**
    -   **连接场景：专线接入**
    -   **创建路由器接口场景：只创建接受端**
    -   **路由器类型： VPC路由器**
    -   **地域：华东1（杭州）**
    -   **本端VPC ID：vpc-87654321**
    -   **对端地域：华北2（北京）**
    -   **对端接入点：大兴A**
    -   **对端路由器类型：边界路由器**
4.  单击**立即购买**。

    大约1分钟后，返回路由器接口列表页面，选择对应的地域，即可看到账号B的路由器接口。本教程中账号B的路由器接口ID为ri-BBB。


## 步骤三：发起连接 {#section_w5q_bn5_ydb .section}

创建路由器接口后需要添加对端路由器接口，并发起连接打通路由器接口的通信。只有发起端路由器接口才可以发起连接。

为账号B的VPC路由器接口添加对端

1.  使用帐号B登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，选择**路由器接口**。
3.  选择路由器接口的所属的地域，找到目标路由器接口。
4.  单击**对端路由器接口**列下的**添加**，或者单击**更多** \> **编辑对端路由器接口信息**。
5.  在弹出的对话框中，选择**其他账户**，然后分别填写账号A的账号ID（12345678）、边界路由器ID（vbr-AAA）、路由器接口ID（ri-AAA）。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13863/4230_zh-CN.png)

为账号A的边界路由器的路由器接口添加对端并发起连接

完成以下操作为账号A的边界路由器的路由器接口添加对端并发起连接：

1.  使用帐号A登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，选择**路由器接口**。
3.  选择路由器接口的所属的地域，找到目标路由器接口。
4.  单击**对端路由器接口**列下的**添加**，或者单击**更多** \> **编辑对端路由器接口信息**。
5.  在弹出的对话框中，选择**其他账户**，然后分别填写账号B的账号ID（87654321）、VPC的路由器ID（vrt-BBB）、路由器接口ID（ri-BBB）。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13863/4231_zh-CN.png)

6.  找到边界路由器的路由器接口，单击**发起连接**。

    当两个账号下的路由器接口ri-AAA和ri-BBB的状态为**已激活**时，表示连接成功。


## 步骤四：配置路由 {#section_f4d_z45_ydb .section}

路由器接口创建好后，您还需要配置路由，这样本地IDC与VPC之间在网络层面上才能互通。

配置边界路由器的路由

完成以下操作将VBR上访问IDC（网段：172.16.0.0/12）的流量转发至物理专线：

1.  使用帐号A登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**边界路由器**。
3.  找到目标边界路由器，单击**管理**，然后在边界路由器详情页单击**添加路由**。
4.  配置路由。本操作的路由配置如下：

    -   **目标网段**：本地IDC的网段。在本例中即172.16.0.0/12。
    -   **下一跳方式**：指向专线方向，并选择创建好的专线。
    完成以下操作将VBR上访问VPC（网段：192.168.0.0/16）的流量转发至VPC：


1.  使用帐号A登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**边界路由器**。
3.  找到目标边界路由器，单击**管理**，然后在边界路由器详情页单击**添加路由**。
4.  配置路由。本操作的路由配置如下：
    -   **目标网段**：对端VPC的网段。在本例中即192.168.0.0/16。
    -   **下一跳方向**：指向VPC方向
    -   **下一跳**：选择边界路由器的路由器接口，在本例中为ri-BBB。

配置VPC的路由

完成以下操作，添加一条路由将VPC中访问IDC（网段：172.16.0.0/12）的流量转发至 VBR：

1.  使用帐号B登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**路由器接口**，找到目标路由器接口，然后单击**路由配置**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13863/4234_zh-CN.png)

3.  配置路由，本操作的路由配置如下：
    -   **目标网段**：本地IDC的网段。在本例中即172.16.0.0/12。
    -   **下一跳类型**：路由器接口
    -   **路由器接口**：选择VPC-B的路由器接口，在本例中为ri-AAA。

配置本地IDC接入设备路由

至此，已完成阿里云上的路由配置，客户专线接入设备还需增加VPC网段的路由，指向专线阿里云侧IP，例如：

```
ip route 192.168.0.0/16 10.100.0.1
```

您也可以配置BGP动态路由，将流量指向边界路由器：

1.  创建BGP组，详情参见[创建BGP组](../cn.zh-CN/用户指南/BGP/管理BGP组.md#section_q2j_hz1_ydb)。
2.  在BGP组中添加BGP邻居，详情参见[创建BGP邻居](../cn.zh-CN/用户指南/BGP/管理BGP邻居.md#section_fxm_rbb_ydb)。
3.  添加BGP路由，详情参见[添加BGP路由](../cn.zh-CN/用户指南/BGP/宣告BGP网段.md#)。

    **说明：** BGP路由的目标网段必须与配置静态路由配置的网段一致。在本教程中即192.168.0.0/16。


至此，已经完成了全部配置。

## 步骤五： 验收测试 {#section_njh_gr5_ydb .section}

网络互通后，请测试物理专线速率，以确保满足业务需求。详细测速方式请参考文档[物理专线网络性能测试](cn.zh-CN/最佳实践/物理专线网络性能测试方法.md#)。

